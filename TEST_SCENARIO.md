# Тестовый сценарий для системы ролей

## Подготовка

1. **Убедитесь, что приложение запущено:**
   ```bash
   .\venv\Scripts\activate
   python app.py
   ```

2. **Откройте браузер:** http://localhost:5000

## Сценарий тестирования

### 1. Вход как администратор

- Перейдите на страницу входа: http://localhost:5000/login
- Войдите с учетными данными администратора (Admin / ваш пароль)
- После входа проверьте, что в меню появился красный пункт "Управление пользователями"

### 2. Просмотр профиля

- Перейдите в "Профиль"
- Убедитесь, что отображается роль "Администратор" с красным бейджем

### 3. Просмотр панели управления

- Перейдите на "Панель управления" (Dashboard)
- Убедитесь, что появилась новая карточка "Управление пользователями" с красной рамкой

### 4. Управление пользователями

- Нажмите на "Управление пользователями" или перейдите по ссылке в меню
- Вы должны увидеть таблицу со всеми пользователями
- Ваша строка должна быть выделена синим цветом
- У вашей записи кнопка "Изменить роль" должна быть неактивна

### 5. Регистрация тестового пользователя

- Откройте окно в режиме инкогнито или другой браузер
- Зарегистрируйте нового пользователя:
  - Имя: TestUser
  - Email: test@example.com
  - Пароль: test123
- После регистрации войдите в систему
- Убедитесь, что роль "Пользователь" с серым бейджем
- Убедитесь, что пункта "Управление пользователями" в меню НЕТ

### 6. Изменение роли тестового пользователя

- Вернитесь в окно администратора
- Перейдите в "Управление пользователями"
- Найдите TestUser в таблице
- Нажмите "Изменить роль"
- Выберите "Аналитик" из выпадающего списка
- Нажмите "Изменить роль"
- Убедитесь, что появилось сообщение об успешном изменении
- Проверьте, что в таблице роль изменилась на "Аналитик" с синим бейджем

### 7. Проверка изменения роли

- В окне с TestUser обновите страницу
- Перейдите в профиль
- Убедитесь, что роль изменилась на "Аналитик"

### 8. Тестирование других ролей

- Попробуйте изменить роль TestUser на "Бухгалтер"
- Проверьте отображение зеленого бейджа
- Попробуйте назначить TestUser администратором
- Проверьте, что у TestUser появился доступ к управлению пользователями

### 9. Защита от изменения собственной роли

- Войдите как администратор
- Попробуйте изменить свою собственную роль
- Убедитесь, что кнопка "Изменить роль" неактивна

### 10. Проверка доступа без прав

- Войдите как обычный пользователь (не администратор)
- Попробуйте перейти напрямую на: http://localhost:5000/admin/users
- Убедитесь, что появляется сообщение "У вас нет прав для доступа к этой странице"
- Убедитесь, что вас перенаправило на дашборд

## Ожидаемые результаты

✅ Администраторы могут просматривать список всех пользователей
✅ Администраторы могут изменять роли других пользователей
✅ Администраторы не могут изменять свою собственную роль
✅ Обычные пользователи не имеют доступа к административным функциям
✅ Роли корректно отображаются в профиле и таблице пользователей
✅ Изменения ролей отображаются в реальном времени
✅ Все роли имеют правильные цветовые обозначения

## Устранение проблем

**Проблема:** Не могу войти как администратор

**Решение:** Запустите скрипт `python make_admin.py` для назначения администратора

---

**Проблема:** Ошибка "no such column: users.role"

**Решение:** Запустите скрипт миграции `python migrate_add_roles.py`

---

**Проблема:** Приложение не запускается

**Решение:** 
1. Активируйте виртуальное окружение: `.\venv\Scripts\activate`
2. Установите зависимости: `pip install -r requirements.txt`
3. Запустите приложение: `python app.py`

